################################################################################
# Applications Layer - User Applications
#
# Deploy your custom applications here using Helmfile, or manage via ArgoCD.
#
# HOW TO ADD A NEW APP:
# 1. Copy apps/example/ to apps/<your-app>/
# 2. Customize Chart.yaml, values.yaml, and templates/
# 3. Add a release below (copy the example-app release)
# 4. Add app config to environments/<env>/values.yaml under apps.<your-app>
# 5. Add secrets to environments/<env>/secrets.yaml under apps.<your-app>
# 6. Run: helmfile -e <env> -l component=<your-app> sync
################################################################################

releases:
  #-----------------------------------------------------------------------------
  # Example Application
  #
  # Demonstrates the full pattern:
  # - Ingress with TLS
  # - EFS persistent storage
  # - Database/Redis connections
  #
  # Enable by setting apps.example.enabled: true in environment values
  #-----------------------------------------------------------------------------
  - name: example-app
    namespace: example
    createNamespace: true
    chart: ../apps/example
    labels:
      layer: apps
      component: example
    condition: apps.example.enabled
    values:
      - replicaCount: {{ .Values.apps.example.replicas | default 1 }}

        image:
          repository: {{ .Values.apps.example.image.repository | default "nginx" }}
          tag: {{ .Values.apps.example.image.tag | default "alpine" }}

        # Ingress - serve on example.<domain>
        ingress:
          enabled: {{ .Values.apps.example.ingress.enabled | default false }}
          host: {{ .Values.apps.example.ingress.host | default (printf "example.%s" .Values.domain) }}
          tlsSecretName: wildcard-tls

        # EFS/NFS persistent storage
        persistence:
          enabled: {{ .Values.apps.example.persistence.enabled | default false }}
          storageClassName: {{ .Values.storage.className | default "efs-sc" }}
          size: {{ .Values.apps.example.persistence.size | default "5Gi" }}
          mountPath: /data

        # Database connection (from Terraform RDS)
        database:
          enabled: {{ .Values.apps.example.database.enabled | default false }}
          host: {{ .Values.apps.example.database.host | default "" }}
          port: {{ .Values.apps.example.database.port | default "5432" }}
          name: {{ .Values.apps.example.database.name | default "" }}
          username: {{ .Values.apps.example.database.username | default "" }}
          password: {{ .Values.apps.example.database.password | default "" }}

        # Redis connection (from Terraform ElastiCache)
        redis:
          enabled: {{ .Values.apps.example.redis.enabled | default false }}
          host: {{ .Values.apps.example.redis.host | default "" }}
          port: {{ .Values.apps.example.redis.port | default "6379" }}
          password: {{ .Values.apps.example.redis.password | default "" }}

        resources:
          requests:
            cpu: {{ .Values.apps.example.resources.requests.cpu | default "50m" }}
            memory: {{ .Values.apps.example.resources.requests.memory | default "64Mi" }}
          limits:
            cpu: {{ .Values.apps.example.resources.limits.cpu | default "200m" }}
            memory: {{ .Values.apps.example.resources.limits.memory | default "128Mi" }}

#-----------------------------------------------------------------------------
# ADD YOUR APPS BELOW
#
# Copy the example-app release above and customize:
#
#   - name: my-app
#     namespace: my-app
#     createNamespace: true
#     chart: ../apps/my-app
#     labels:
#       layer: apps
#       component: my-app
#     condition: apps.myApp.enabled
#     values:
#       - replicaCount: {{ .Values.apps.myApp.replicas | default 2 }}
#         image:
#           repository: {{ .Values.apps.myApp.image.repository }}
#           tag: {{ .Values.apps.myApp.image.tag | default "latest" }}
#         ingress:
#           enabled: true
#           host: my-app.{{ .Values.domain }}
#         # ... rest of config
#-----------------------------------------------------------------------------
